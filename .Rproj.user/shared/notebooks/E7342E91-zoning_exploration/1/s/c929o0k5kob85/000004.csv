"0","zoning_data <- parcel_data@data[,c(1, 21:38)]"
"0","#note, date is not always mid month, doing this for simplicity"
"0","names(zoning_data)[grep(""20"", names(zoning_data))] <- paste0('15', names(zoning_data)[grep(""20"", names(zoning_data))])"
"0","#put data in long format"
"0","zoning_data <- gather(zoning_data, key = ""Date"", value = ""Zoning"", -c(""OBJECTID"", ""WARD"", ""LANDMARKED""))"
"2","attributes are not identical across measure variables;
they will be dropped"
"0","#convert to dates"
"0","zoning_data <- mutate(zoning_data, Date=as.Date(Date, ""%d%b%Y""),"
"0","                                   LANDMARKED = as.Date(LANDMARKED, format = ""%m/%d/%Y""),"
"0","                                   WARD = as.numeric(WARD))"
"0","#create floor area ratio data"
"0","Zoning <- c(""RS-1"", ""RS-2"", ""RS-3"", ""RT-3.5"", ""RT-4"", ""RT-4A"", ""RM-4.5"", ""RM-5"", ""RM-5.5"", ""RM-6"", ""RM-6.5"")"
"0","#note: RT4-A is 1.2-1.5, but here counting as 1.5"
"0","FAR <- c(0.5, 0.65, 0.9, 1.05, 1.2, 1.5, 1.7, 2, 2.5, 4.4, 6.6)"
"0","far_levels <- data.frame(Zoning, FAR, stringsAsFactors = F)"
"0","#merge floor area ratio data and filter to just residential tracts"
"0","zoning_data <- left_join(zoning_data, far_levels, by = ""Zoning"") %>%"
"0","                  subset(!is.na(FAR), select = c(OBJECTID, WARD, Date, Zoning, FAR, LANDMARKED))"
"0","zoning_data <- zoning_data[order(zoning_data$LANDMARKED, zoning_data$OBJECTID),]"
"0","#lag the timeseries data"
"0","zoning_data_lag <- group_by(zoning_data, OBJECTID) %>%"
"0","              mutate(LAG_FAR = dplyr::lag(FAR, n = 1, default = NA_character_, order_by = Date))"
"0","#get landmark dummies"
"0","landmarked_parcels <- filter(zoning_data_lag, LANDMARKED > 0)"
"0","landmarked_parcels <- landmarked_parcels[!duplicated(landmarked_parcels[,1:2]),]"
"0","landmarked_parcels %<>% mutate(Date = LANDMARKED, LANDMARKED = 1)"
"0","#merge landmark dummy obs to parcel dataset"
"0","zoning_data_lag$LANDMARKED <- 0 %>% as.numeric()"
"0","zoning_data_lag %<>% bind_rows(landmarked_parcels)"
"0","#create upzone and downzone dummies"
"0","zoning_data_lag$UPZONE <- ifelse(zoning_data_lag$FAR > zoning_data_lag$LAG_FAR, 1, 0)"
"0","zoning_data_lag$DOWNZONE <- ifelse(zoning_data_lag$FAR < zoning_data_lag$LAG_FAR, 1, 0)"
"0","write_csv(zoning_data_lag, here(""clean_data"", ""zoning_data_lag.csv""))"
