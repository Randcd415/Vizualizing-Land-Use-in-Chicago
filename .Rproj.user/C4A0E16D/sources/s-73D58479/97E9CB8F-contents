---
title: "pset_3"
author: "Student ID: 12173883"
date: "November 3, 2018"
output:
  pdf_document: default
  html_document: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(haven)
library(broom)
library(knitr)
library(labelled)
library(tidyverse)
library(lfe)
data <- read_dta("AganStarrQJEData.dta")
#remove reverse compliers
data <- filter(data, remover != -1)

#var.labels <- attr(data,"var.labels")
#data.key <- data.frame(var.name = names(data), var.labels)

```


### Question 1

Response rate for people who committed crimes is 8.5%, which is less than the response rate for people who haven't committed crimes, which is 13.6%. This difference is statistically significant, with a t score of 4.2.

We can interpret these as causally. These resumes are not real people, but are data points in a designed experiment in which a criminal record is randomly allocated across matched pairs of resumes which are identical in unobservables. The applications are also sent in even proportions of crime vs no crime to stores, so varying store-level affects will not be affecting these means. So any change resulting in crime is causal because there are not confounding variables.

```{r}
#restrict to pre BTB period and just applications that have a box
filtered_data <- filter(data, pre == 1, crimbox == 1)

t.test(response ~ crime, data = filtered_data)
```

### Question 2

A) Race does have a statistically significant impact on response rate if the sample is restricted to just removers ==1. White applications are more likely to receive a response. 

This coefficient does have a causal interpretation because the race variable is randomly allocated (because this is an experiment), and fixed effects at the center and chain level are controlled for.

B) The white variable does not significantly change when fixed effects are taken out, although the standard error does get larger (but the coefficient remains significant). This makes sense, because the experiment made sure applications are sent in even proportions of crime vs no crime to different stores.

It is important to include fixed effects to get more precise estimates, because it controls for the noise introduced by different stores and chains.

C) The coefficient on "white" does very slightly increase, but within the margin of the standard error. Indeed, none of the existing coefficients change all that much. The crime coefficient is still significant though, and the adjusted r squared of the third model is higher, suggesting that the crime variable helps to explain more of the variation.

If the white coefficient had changed with the introduction of crime, this does mean that the variable had been subject to omitted variable bias in the previous regression, from this specific omitted variable.

```{r}
#restrict to just box applications in both periods
filtered_data <- filter(data, remover == 1)

mod1 <- lm(response ~ white + ged + empgap + factor(cogroup_comb) + factor(center), data = filtered_data)
mod2 <- lm(response ~ white + ged + empgap, data = filtered_data)
mod3 <- lm(response ~ white + ged + empgap + crime, data = filtered_data)

summary(mod1)$coefficients[1:4,] %>% kable()
summary(mod2)$coefficients[1:4,] %>% kable()
summary(mod3)$coefficients[1:5,] %>% kable()
```

### Question 3

A) the a coefficient would tell you the call back rate in the pre period for applicants that don't have boxes and are not white, all other Xs held constant. B_1 would tell you the difference in call back rate for applications with a box vs without a box for non-white applicants. B_3 would tell you the additional difference in callback rates if the applicant not only has a box, but is also white.

B) I do think box and non box stores may differ in systematic ways. The Agan & Starr paper notes that national store chains who were affected by BTB legislation in other jurisdictions were more likely to remove boxes everywhere they operate, even before local legislation. In addition to no box rates in pre-period correlating with store size, it could also correlate with manager characteristics or even specific type of work. If the manager or the job itself does not require detailed information on criminal records of applicants, they would not require a box.

C) If we restrict the regression to just applications to companies that initially required a box before it was banned, then the a coefficient is the call back rate for non-white applicants in the post period, holding demographics constant. B_1 is the impact on the callback rate of the pre-period box and if you're non-white, b_2 is impact of the callback rate in the post period of being white, and b_3 is the impact on the callback rate of being white in the pre period when the box still existed.

### Question 4
A) Model estimated in code below

B) We should be using standard errors clustered at the center level. And I have done this for the 2 regressions in the problem. This is because the job applications were only sent to stores proximal to the center address, so applicants from the same centers applied to the same stores.The error terms are likely to be correlated by location because of unobservables in the local economy, local attitudes, and local stores. Even if the coefficients don't change, this will increase precision of our estimates.

C) Crimebox is not statistically significant. We are in the pre-period so all Crimebox does is differentiate between stores that ask about criminal conviction and stores that do not. We wouldn't expect this different to have an effect on the average response rate to applicants, because regardless about caring about crime in employees, every store still needs to hire people.

However, the interaction between crimebox and white is significant and negative, and almost identical in magnitude to the white variable, which suggests that employers that seek information about criminal records are not more likely to hire white people. This fits with the paper's hypothesis that employers use race to filter on criminal convictions, when information asymmetry about crime exists.

D) The crimebox coefficient is not significant, which just means there is not a statistically significant change in response rate between the pre and post period (which is all crimebox distinguishers because we have filtered to remover == 1).

The white coefficient is significant, which means that in the post period (because it isn't interacted in white) these employers are more likely to hire white people. The interaction of white and crimebox is referring to white applicants in the pre period (before the crimebox had to be removed). This coefficient is negative and significant, and similar in magnitude to the uninteracted white variable, which supports our findings from the model in 4a, that these employers subsitute to filtering by race when they are no longer able to ask about crime.

```{r, message=FALSE}
#filter data to just pre period
filtered_data <- filter(data, pre == 1)

mod4 <- felm(response ~ crimbox + white + I(crimbox * white) + empgap + ged + center, cluster = 'center', data = filtered_data)

summary(mod4)$coefficients[1:6,] %>% kable()

filtered_data <- filter(data, remover == 1)

mod5 <- felm(response ~ crimbox + white + I(crimbox * white) + empgap + ged + center, cluster = 'center', data = filtered_data)

summary(mod5)$coefficients[1:6,] %>% kable()
```

### Question 5

From the models above, we can say that the BTB policy had a causal impact on the criteria that employers in these regions use to screen applicants, specifically regarding race. When BTB was not in effect and employers could ask about crime, the race variable was not significant, but the crime variable was significant and negative, so employers called applicants with criminal convictions back less. 

When BTB goes into effect, and these employers no longer can ask about crime, the white variable becomes significant and positive, and is about the same magnitude as the crime variable had been before BTB, suggesting that employers are substituting to filtering on race as a proxy for crime.

These effects are significant even when controlling for possible confounders, such as GED, employment gap, and for neighborhood and chain effects. And given that this was an experiment in which crime and race were randomly assigned, we do not need to be worried about unobserables correlated with treatment and response.



##### True Identity: Cory Rand 
