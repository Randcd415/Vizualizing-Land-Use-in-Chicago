nudge_y = -2.5,
family="Segoe UI Bold",
color = "black",
alpha = .6) +
annotate("text", label="Near West Side", x=29.8, y=-30, alpha = .6, size=3.2, family="Segoe UI Bold") +
scale_color_manual(values = c("#FF5416", "#00B28F")) +
labs(x = "Percentage Point Change in White Population",
y = "Percentage Point Change in Black Population",
title = "Most Neighborhoods are Less Black, More White than in 2000",
subtitle = "Neighborhood Demographic Change: 2000-2017",
caption = "Data from American Community Survey") +
theme_classic() +
theme_custom +
theme(axis.line = element_blank()) +
theme(legend.position="none")
temp_data <- neighborhood_master_wide %>%
mutate(pblack_2000_2017 = `2017_pblack` - `2000_pblack`,
pwhite_2000_2017 = `2017_pwhite` - `2000_pwhite`) %>%
subset(subset = RegionID != "403159" & !is.na(pwhite_2000_2017), select=c(long, lat, group, RegionID, pwhite_2000_2017, pblack_2000_2017)) %>%
left_join(zillow_shp@data[, c("RegionID", "Name")]) %>%
mutate(highlight = pwhite_2000_2017 > 0 & pblack_2000_2017 < 0)
p2 <- ggplot() +
geom_polygon(data = temp_data[which(temp_data$highlight > 0),],
aes(x = long, y = lat, group = group), fill = "#00B28F", alpha = .8) +
geom_path(data = temp_data[which(temp_data$highlight > 0),],
aes(x = long, y = lat, group = group), col = "grey", alpha = .4) +
geom_polygon(data = temp_data[which(temp_data$highlight == 0),],
aes(x = long, y = lat, group = group), fill = "#FF5416", alpha = .6) +
geom_path(data = temp_data[which(temp_data$highlight == 0),],
aes(x = long, y = lat, group = group), col = "grey", alpha = .4) +
coord_equal() +
theme_minimal() +
theme(axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
theme(legend.position="none")
rm(temp_data)
grid.newpage()
page.layout <- grid.layout(nrow = 1, ncol = 2, widths=c(.7, .3))
pushViewport(viewport(layout = page.layout))
print(p1, vp=viewport(layout.pos.row = 1, layout.pos.col = 1))
print(p2, vp=viewport(layout.pos.row = 1, layout.pos.col = 2))
plot_data <- neighborhood_master_wide %>%
mutate(pblack_2000_2017 = (`2017_pblack` - `2000_pblack`)* 100,
pwhite_2000_2017 = (`2017_pwhite` - `2000_pwhite`)* 100) %>%
subset(subset = RegionID != "403159" & !is.na(pwhite_2000_2017), select=c(long, lat, group, RegionID, pwhite_2000_2017, pblack_2000_2017)) %>%
left_join(zillow_shp@data[, c("RegionID", "Name")]) %>%
distinct(RegionID, .keep_all = T) %>%
mutate(highlight = pwhite_2000_2017 > 0 & pblack_2000_2017 < 0)
p1 <- plot_data %>%
ggplot(aes(x = pwhite_2000_2017, y = pblack_2000_2017, label = Name, col = highlight)) +
annotate("rect", xmin = -Inf, xmax = 0, ymin = -Inf, ymax = Inf, fill= "grey", alpha = 0.1)  +
annotate("rect", xmin = 0, xmax = Inf, ymin = 0, ymax = Inf, fill= "grey", alpha = 0.1)  +
geom_jitter(alpha = 0.5) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0) +
geom_text(data = plot_data[which(plot_data$pwhite_2000_2017 > 20 & plot_data$pblack_2000_2017 < -35),],
aes(x = pwhite_2000_2017, y = pblack_2000_2017, label = Name),
size = 3.2,
nudge_y = -2.5,
family="Segoe UI Bold",
color = "black",
alpha = .6) +
annotate("text", label="Near West Side", x=29.8, y=-30, alpha = .6, size=3.2, family="Segoe UI Bold") +
scale_color_manual(values = c("#FF5416", "#00B28F")) +
labs(x = "Percentage Point Change in White Population",
y = "Percentage Point Change in Black Population",
title = "Most Neighborhoods are Less Black, More White than in 2000",
subtitle = "Neighborhood Demographic Change: 2000-2017",
caption = "Data from American Community Survey") +
theme_classic() +
theme_custom +
theme(axis.line = element_blank()) +
theme(legend.position="none")
temp_data <- neighborhood_master_wide %>%
mutate(pblack_2000_2017 = `2017_pblack` - `2000_pblack`,
pwhite_2000_2017 = `2017_pwhite` - `2000_pwhite`) %>%
subset(subset = RegionID != "403159" & !is.na(pwhite_2000_2017), select=c(long, lat, group, RegionID, pwhite_2000_2017, pblack_2000_2017)) %>%
left_join(zillow_shp@data[, c("RegionID", "Name")]) %>%
mutate(highlight = pwhite_2000_2017 > 0 & pblack_2000_2017 < 0)
p2 <- ggplot() +
geom_polygon(data = temp_data[which(temp_data$highlight > 0),],
aes(x = long, y = lat, group = group), fill = "#00B28F", alpha = .8) +
geom_path(data = temp_data[which(temp_data$highlight > 0),],
aes(x = long, y = lat, group = group), col = "grey", alpha = .4) +
geom_polygon(data = temp_data[which(temp_data$highlight == 0),],
aes(x = long, y = lat, group = group), fill = "#FF5416", alpha = .2) +
geom_path(data = temp_data[which(temp_data$highlight == 0),],
aes(x = long, y = lat, group = group), col = "grey", alpha = .4) +
coord_equal() +
theme_minimal() +
theme(axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
theme(legend.position="none")
rm(temp_data)
grid.newpage()
page.layout <- grid.layout(nrow = 1, ncol = 2, widths=c(.7, .3))
pushViewport(viewport(layout = page.layout))
print(p1, vp=viewport(layout.pos.row = 1, layout.pos.col = 1))
print(p2, vp=viewport(layout.pos.row = 1, layout.pos.col = 2))
plot_data <- master %>%
filter(YEAR == 2017, pop > 0 & pop < 2000000) %>%
mutate(pop_bins = cut(pop, breaks = seq(0, 99000, 33000), include.lowest = TRUE),
pop = pop / 1000)
ggplot() +
geom_point(data = plot_data[which(plot_data$pwhite < .87),],
aes(x = pwhite, y = mean_hvi, size = pop),
alpha = .2,
col = "#FF5416") +
geom_point(data = plot_data[which(plot_data$pwhite > .87),],
aes(x = pwhite, y = mean_hvi, size = pop),
col = "#00B28F",
alpha = .5) +
labs(
title="Whitest Neighborhoods have Expensive Homes and Low Populations",
#subtitle="Average Home Values and Demographic Data in 2017 ",
caption="Data from Zillow and American Community Survey",
x="White Percentage of Population",
y="Average Home Value in 2017",
size = "Neighborhood Population \n(Thousands)"
) +
theme_classic() +
#scale_color_manual(labels = c("0-33k", "33-66k", "66-99k"), values = c("#00B28F", "#FF5416","#D60000")) +
scale_y_continuous(labels = c("0", "$200k", "$400k", "$600k")) +
scale_x_continuous(labels = scales::percent) +
guides(size = guide_legend(override.aes = list(col = "grey"))) +
theme(legend.position = c(.2, .73)) +
theme_custom
plot_data <- master %>%
filter(YEAR == 2017, pop > 0 & pop < 2000000) %>%
mutate(pop_bins = cut(pop, breaks = seq(0, 99000, 33000), include.lowest = TRUE),
pop = pop / 1000)
ggplot() +
geom_point(data = plot_data[which(plot_data$pwhite < .87),],
aes(x = pwhite, y = mean_hvi, size = pop),
alpha = .2,
col = "#FF5416") +
geom_point(data = plot_data[which(plot_data$pwhite > .87),],
aes(x = pwhite, y = mean_hvi, size = pop),
col = "#00B28F",
alpha = .8) +
labs(
title="Whitest Neighborhoods have Expensive Homes and Low Populations",
#subtitle="Average Home Values and Demographic Data in 2017 ",
caption="Data from Zillow and American Community Survey",
x="White Percentage of Population",
y="Average Home Value in 2017",
size = "Neighborhood Population \n(Thousands)"
) +
theme_classic() +
#scale_color_manual(labels = c("0-33k", "33-66k", "66-99k"), values = c("#00B28F", "#FF5416","#D60000")) +
scale_y_continuous(labels = c("0", "$200k", "$400k", "$600k")) +
scale_x_continuous(labels = scales::percent) +
guides(size = guide_legend(override.aes = list(col = "grey"))) +
theme(legend.position = c(.2, .73)) +
theme_custom
plot_data <- master %>%
filter(YEAR == 2017, pop > 0 & pop < 2000000) %>%
mutate(pop_bins = cut(pop, breaks = seq(0, 99000, 33000), include.lowest = TRUE),
pop = pop / 1000)
ggplot() +
geom_point(data = plot_data[which(plot_data$pwhite < .87),],
aes(x = pwhite, y = mean_hvi, size = pop),
alpha = .2,
col = "#FF5416") +
geom_point(data = plot_data[which(plot_data$pwhite > .87),],
aes(x = pwhite, y = mean_hvi, size = pop),
col = "#00B28F",
alpha = .6) +
labs(
title="Whitest Neighborhoods have Expensive Homes and Low Populations",
#subtitle="Average Home Values and Demographic Data in 2017 ",
caption="Data from Zillow and American Community Survey",
x="White Percentage of Population",
y="Average Home Value in 2017",
size = "Neighborhood Population \n(Thousands)"
) +
theme_classic() +
#scale_color_manual(labels = c("0-33k", "33-66k", "66-99k"), values = c("#00B28F", "#FF5416","#D60000")) +
scale_y_continuous(labels = c("0", "$200k", "$400k", "$600k")) +
scale_x_continuous(labels = scales::percent) +
guides(size = guide_legend(override.aes = list(col = "grey"))) +
theme(legend.position = c(.2, .73)) +
theme_custom
knitr::opts_chunk$set(echo = TRUE)
library(RColorBrewer)
library(gghighlight)
library(lubridate)
library(tidyverse)
library(here)
library(magrittr)
library(tmap)
library(grid)
library(rgdal)
library(gridExtra)
library(extrafont)
library(sf)
library(scales)
invisible(loadfonts())
######### Zoning ############3
zoning <- read_csv(here("clean_data", "zoning.csv"), col_names = T) %>%
mutate(YEAR = year(Date),
REGION = as.character(REGION)) %>%
group_by(REGION, YEAR) %>%
summarize(UPZONE = sum(UPZONE, na.rm = T),
DOWNZONE = sum(DOWNZONE, na.rm = T),
LANDMARKED = sum(LANDMARKED, na.rm = T),
FAR = mean(FAR, na.rm = T))
zoning <- zoning[order(zoning$REGION, zoning$YEAR),] %>%
group_by(REGION) %>%
mutate(UPZONE_cs = cumsum(UPZONE),
DOWNZONE_cs = cumsum(DOWNZONE),
LANDMARKED_cs = cumsum(LANDMARKED))
############# PERMITS ####################
permits <- read_csv(here("clean_data", "permits.csv"), col_names = T)
permits %<>% mutate(YEAR = year(permits$ISSUE_DATE),
REGION = as.character(RegionID),
WORK_DESCRIPTION =toupper(WORK_DESCRIPTION))
permits <-  permits[order(permits$REGION, permits$YEAR),] %>%
group_by(REGION, YEAR, PERMIT_TYPE) %>%
summarize(num_permits = length(ID)) %>%
group_by(REGION, PERMIT_TYPE) %>%
mutate(permits_cs = cumsum(num_permits))
permits_filt <- read_csv(here("clean_data", "permits_filt.csv"), col_names = T)
permits_filt$LATITUDE <- str_split_fixed(permits_filt$LOCATION, ", ", 2)[,1] %>% as.numeric()
permits_filt$LONGITUDE <- str_split_fixed(permits_filt$LOCATION, ", ", 2)[,2] %>% as.numeric()
permits_filt <- st_as_sf(permits_filt, coords = c("LONGITUDE", "LATITUDE"), crs = 4269)
permits_filt$LATITUDE <- str_split_fixed(permits_filt$LOCATION, ", ", 2)[,1] %>% as.numeric()
permits_filt$LONGITUDE <- str_split_fixed(permits_filt$LOCATION, ", ", 2)[,2] %>% as.numeric()
############# HOME PRICE DATA ########################
zhvi <- read_csv(here("clean_data", "zhvi.csv"), col_names = T)
zhvi$RegionID %<>% as.character()
missing_vals <- zhvi %>% filter(!is.na(HVI)) %>% group_by(RegionName) %>% summarize(length = length(Date)) %>% subset(length < 272, select = RegionName)
zhvi_clean <- zhvi %>% filter(!(RegionName %in% missing_vals$RegionName)) %>% group_by(Date) %>%
mutate(ranking = order(order(HVI, decreasing = T)),
YEAR = year(Date)) %>% ungroup() %>%
group_by(RegionID, RegionName, YEAR) %>%
summarize(mean_hvi = mean(HVI, na.rm = T),
mean_rank = mean(ranking, na.rm = T))
############# ACS DATA FROM BROWN LOGITUDINAL DATABASE ########################
acs <- read_csv(here("clean_data", "acs_full.csv"), col_names = T)
acs %<>% mutate(YEAR = as.numeric(YEAR),
REGION = as.character(REGION),
trtid10 = as.character(trtid10))
acs_5 <- read_csv(here("clean_data", "acs_2013_2017.csv")) %>%
group_by(REGION) %>%
summarize(pop = sum(pop_e, na.rm = T),
nhwht = sum(white_pop_e, na.rm = T),
nhblk = sum(black_pop_e, na.rm = T),
asian = sum(asian_pop_e, na.rm = T),
hisp = sum(hispanic_pop_e, na.rm = T),
ohu = sum(occupied_e, na.rm = T),
own = sum(owned_e, na.rm = T),
hu = sum(housing_e, na.rm = T)) %>%
mutate(pwhite = nhwht/pop,
pblack = nhblk/pop,
pasian = asian/pop,
phisp = hisp/pop,
pohu = ohu/hu,
pown = own/ohu,
pop_d_h = pop/hu,
h_d_pop = hu/pop,
YEAR = 2017,
REGION = as.character(REGION))
############ AGGREGATE CENSUS DATA TO TRACT LEVEL ############
acs_neighborhood <- acs %>%
group_by(REGION, YEAR) %>%
summarize(pop = sum(pop, na.rm = T),
nhwht = sum(nhwht, na.rm = T),
nhblk = sum(nhblk, na.rm = T),
asian = sum(asian, na.rm = T),
hu = sum(hu, na.rm = T),
vac = sum(vac, na.rm = T),
ohu = sum(ohu, na.rm = T),
own = sum(own, na.rm = T),
hisp = sum(hisp, na.rm = T),
col = sum(col, na.rm = T),
unemp = sum(unemp, na.rm = T),
family = sum(family, na.rm = T),
hinc = mean(hinc, na.rm = T),
h30old = sum(h30old, na.rm = T),
mrent = mean(mrent, na.rm = T),
hincw = mean(hincw, na.rm = T),
hincb = mean(hincb, na.rm = T),
hinch = mean(hinch, na.rm = T),
multi = sum(multi, na.rm = T)) %>%
mutate(pwhite = nhwht/pop,
pblack = nhblk/pop,
pasian = asian/pop,
phisp = hisp/pop,
pohu = ohu/hu,
pown = own/ohu,
pop_d_h = pop/hu,
h_d_pop = hu/pop) %>%
bind_rows(acs_5)
master <- acs_neighborhood %>%
full_join(zoning, by = c("REGION", "YEAR")) %>%
full_join(permits, by = c("REGION", "YEAR"))  %>%
full_join(zhvi_clean, b = c("REGION" = "RegionID", "YEAR")) %>%
filter(!is.na(REGION))
### zoning
zoning_wide <- zoning[which(zoning$YEAR == 2019),]
### permits
permits_wide <- permits %>%
spread(key = PERMIT_TYPE, value = permits_cs) %>%
group_by(REGION) %>%
summarize(con_permits_cs = max(`PERMIT - NEW CONSTRUCTION`, na.rm = T),
des_permits_cs = max(`PERMIT - WRECKING/DEMOLITION`, na.rm = T))
### home value
zhvi_wide <- zhvi_clean %>%
filter(YEAR == 1996 | YEAR == 2010 | YEAR == 2018) %>%
unite(temp, c("mean_hvi", "mean_rank")) %>%
spread(key = "YEAR", value = temp) %>%
separate("1996", into = paste0("1996_", c("mean_hvi", "mean_rank")), sep = "_", convert = T) %>%
separate("2010", into = paste0("2010_", c("mean_hvi", "mean_rank")), sep = "_", convert = T) %>%
separate("2018", into = paste0("2018_", c("mean_hvi", "mean_rank")), sep = "_", convert = T) %>%
mutate(change_rank = `2018_mean_rank` - `1996_mean_rank`,
change_hvi = `2018_mean_hvi` - `1996_mean_hvi`)
### acs data
acs_wide <- acs_neighborhood %>%
subset(subset = (YEAR == 1970 | YEAR == 1980 | YEAR == 1990 | YEAR ==  2000 | YEAR ==  2010 | YEAR == 2017)) %>%
unite(temp, names(acs_neighborhood)[3:29]) %>%
spread(key = "YEAR", value = "temp") %>%
separate("1970", into = paste0("1970_", names(acs_neighborhood)[3:29]), sep = "_", convert = T) %>%
separate("1980", into = paste0("1980_", names(acs_neighborhood)[3:29]), sep = "_", convert = T) %>%
separate("1990", into = paste0("1990_", names(acs_neighborhood)[3:29]), sep = "_", convert = T) %>%
separate("2000", into = paste0("2000_", names(acs_neighborhood)[3:29]), sep = "_", convert = T) %>%
separate("2010", into = paste0("2010_", names(acs_neighborhood)[3:29]), sep = "_", convert = T) %>%
separate("2017", into = paste0("2017_", names(acs_neighborhood)[3:29]), sep = "_", convert = T)
master_wide <- acs_wide %>%
full_join(zoning_wide, by = "REGION") %>%
full_join(permits_wide) %>%
full_join(zhvi_wide, by = c("REGION" = "RegionID"))
############ Merge Tract SHAPEFILE WITH MASTER
tract_2010 <- readOGR(here("raw_data", "Boundaries - Census Tracts - 2010"), layer = "geo_export_52dfa5f1-1eaf-49e1-9862-1998098d508c")
tract_2010@data$geoid10 %<>% as.character()
############ MERGE Neighborhood Shapefile WITH MASTERS
zillow_shp <- readOGR(here("raw_data", "ZillowNeighborhoods-IL"), layer = "ZillowNeighborhoods-IL")
zillow_shp$RegionID %<>% as.character()
zillow_shp@data$id <- rownames(zillow_shp@data)
zillow_shp <- zillow_shp[which(zillow_shp$City == "Chicago"),]
neighborhood_master <- fortify(zillow_shp) %>%
full_join(zillow_shp@data, by = "id") %>%
full_join(master, by = c("RegionID" = "REGION"))
neighborhood_master_wide <- fortify(zillow_shp) %>%
full_join(zillow_shp@data, by = "id") %>%
full_join(master_wide, by = c("RegionID" = "REGION"))
theme_custom <-   theme(plot.title = element_text(family="Segoe UI Semibold", size=13.5),
plot.subtitle = element_text(family="Segoe UI Light", size=11),
plot.caption = element_text(family="Segoe UI Light", size=9),
axis.title=element_text(family="Segoe UI Semibold", size=10),
axis.text=element_text(family="Segoe UI Light", size=10),
legend.title=element_text(family="Segoe UI Semibold", size=9),
legend.text = element_text(family="Segoe UI Light", size=9),
#legend.background=element_blank(),
axis.line = element_line(colour = "#616161"),
panel.grid.major = element_line(color = "#E5E5E5"),
panel.grid.minor = element_line(color = "#EDEDED"))
names(neighborhood_master_wide)
plot_data <- neighborhood_master_wide %>%
mutate(pblack_2000_2017 = (`2017_pblack` - `2000_pblack`)* 100,
pwhite_2000_2017 = (`2017_pwhite` - `2000_pwhite`)* 100) %>%
subset(subset = RegionID != "403159" & !is.na(pwhite_2000_2017), select=c(long, lat, group, RegionID, pwhite_2000_2017, pblack_2000_201, `2010_pop`)) %>%
left_join(zillow_shp@data[, c("RegionID", "Name")]) %>%
distinct(RegionID, .keep_all = T) %>%
mutate(highlight = pwhite_2000_2017 > 0 & pblack_2000_2017 < 0)
plot_data <- neighborhood_master_wide %>%
mutate(pblack_2000_2017 = (`2017_pblack` - `2000_pblack`)* 100,
pwhite_2000_2017 = (`2017_pwhite` - `2000_pwhite`)* 100) %>%
subset(subset = RegionID != "403159" & !is.na(pwhite_2000_2017), select=c(long, lat, group, RegionID, pwhite_2000_2017, pblack_2000_2010, `2010_pop`)) %>%
left_join(zillow_shp@data[, c("RegionID", "Name")]) %>%
distinct(RegionID, .keep_all = T) %>%
mutate(highlight = pwhite_2000_2017 > 0 & pblack_2000_2017 < 0)
plot_data <- neighborhood_master_wide %>%
mutate(pblack_2000_2017 = (`2017_pblack` - `2000_pblack`)* 100,
pwhite_2000_2017 = (`2017_pwhite` - `2000_pwhite`)* 100) %>%
subset(subset = RegionID != "403159" & !is.na(pwhite_2000_2017), select=c(long, lat, group, RegionID, pwhite_2000_2017, pblack_2000_2017, `2010_pop`)) %>%
left_join(zillow_shp@data[, c("RegionID", "Name")]) %>%
distinct(RegionID, .keep_all = T) %>%
mutate(highlight = pwhite_2000_2017 > 0 & pblack_2000_2017 < 0)
p1 <- plot_data %>%
ggplot(aes(x = pwhite_2000_2017, y = pblack_2000_2017, label = Name, col = highlight, size = `2010_pop`)) +
annotate("rect", xmin = -Inf, xmax = 0, ymin = -Inf, ymax = Inf, fill= "grey", alpha = 0.1)  +
annotate("rect", xmin = 0, xmax = Inf, ymin = 0, ymax = Inf, fill= "grey", alpha = 0.1)  +
geom_jitter(alpha = 0.5) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0) +
geom_text(data = plot_data[which(plot_data$pwhite_2000_2017 > 20 & plot_data$pblack_2000_2017 < -35),],
aes(x = pwhite_2000_2017, y = pblack_2000_2017, label = Name),
size = 3.2,
nudge_y = -2.5,
family="Segoe UI Bold",
color = "black",
alpha = .6) +
annotate("text", label="Near West Side", x=29.8, y=-30, alpha = .6, size=3.2, family="Segoe UI Bold") +
scale_color_manual(values = c("#FF5416", "#00B28F")) +
labs(x = "Percentage Point Change in White Population",
y = "Percentage Point Change in Black Population",
title = "Most Neighborhoods are Less Black, More White than in 2000",
subtitle = "Neighborhood Demographic Change: 2000-2017",
caption = "Data from American Community Survey") +
theme_classic() +
theme_custom +
theme(axis.line = element_blank()) +
theme(legend.position="none")
temp_data <- neighborhood_master_wide %>%
mutate(pblack_2000_2017 = `2017_pblack` - `2000_pblack`,
pwhite_2000_2017 = `2017_pwhite` - `2000_pwhite`) %>%
subset(subset = RegionID != "403159" & !is.na(pwhite_2000_2017), select=c(long, lat, group, RegionID, pwhite_2000_2017, pblack_2000_2017)) %>%
left_join(zillow_shp@data[, c("RegionID", "Name")]) %>%
mutate(highlight = pwhite_2000_2017 > 0 & pblack_2000_2017 < 0)
p2 <- ggplot() +
geom_polygon(data = temp_data[which(temp_data$highlight > 0),],
aes(x = long, y = lat, group = group), fill = "#00B28F", alpha = .8) +
geom_path(data = temp_data[which(temp_data$highlight > 0),],
aes(x = long, y = lat, group = group), col = "grey", alpha = .4) +
geom_polygon(data = temp_data[which(temp_data$highlight == 0),],
aes(x = long, y = lat, group = group), fill = "#FF5416", alpha = .2) +
geom_path(data = temp_data[which(temp_data$highlight == 0),],
aes(x = long, y = lat, group = group), col = "grey", alpha = .4) +
coord_equal() +
theme_minimal() +
theme(axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
theme(legend.position="none")
rm(temp_data)
grid.newpage()
page.layout <- grid.layout(nrow = 1, ncol = 2, widths=c(.7, .3))
pushViewport(viewport(layout = page.layout))
print(p1, vp=viewport(layout.pos.row = 1, layout.pos.col = 1))
print(p2, vp=viewport(layout.pos.row = 1, layout.pos.col = 2))
plot_data <- neighborhood_master_wide %>%
mutate(pblack_2000_2017 = (`2017_pblack` - `2000_pblack`)* 100,
pwhite_2000_2017 = (`2017_pwhite` - `2000_pwhite`)* 100) %>%
subset(subset = RegionID != "403159" & !is.na(pwhite_2000_2017), select=c(long, lat, group, RegionID, pwhite_2000_2017, pblack_2000_2017)) %>%
left_join(zillow_shp@data[, c("RegionID", "Name")]) %>%
distinct(RegionID, .keep_all = T) %>%
mutate(highlight = pwhite_2000_2017 > 0 & pblack_2000_2017 < 0)
p1 <- plot_data %>%
ggplot(aes(x = pwhite_2000_2017, y = pblack_2000_2017, label = Name, col = highlight)) +
annotate("rect", xmin = -Inf, xmax = 0, ymin = -Inf, ymax = Inf, fill= "grey", alpha = 0.1)  +
annotate("rect", xmin = 0, xmax = Inf, ymin = 0, ymax = Inf, fill= "grey", alpha = 0.1)  +
geom_jitter(alpha = 0.5) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0) +
geom_text(data = plot_data[which(plot_data$pwhite_2000_2017 > 20 & plot_data$pblack_2000_2017 < -35),],
aes(x = pwhite_2000_2017, y = pblack_2000_2017, label = Name),
size = 3.2,
nudge_y = -2.5,
family="Segoe UI Bold",
color = "black",
alpha = .6) +
annotate("text", label="Near West Side", x=29.8, y=-30, alpha = .6, size=3.2, family="Segoe UI Bold") +
scale_color_manual(values = c("#FF5416", "#00B28F")) +
labs(x = "Percentage Point Change in White Population",
y = "Percentage Point Change in Black Population",
title = "Most Neighborhoods are Less Black, More White than in 2000",
subtitle = "Neighborhood Demographic Change: 2000-2017",
caption = "Data from American Community Survey") +
theme_classic() +
theme_custom +
theme(axis.line = element_blank()) +
theme(legend.position="none")
temp_data <- neighborhood_master_wide %>%
mutate(pblack_2000_2017 = `2017_pblack` - `2000_pblack`,
pwhite_2000_2017 = `2017_pwhite` - `2000_pwhite`) %>%
subset(subset = RegionID != "403159" & !is.na(pwhite_2000_2017), select=c(long, lat, group, RegionID, pwhite_2000_2017, pblack_2000_2017)) %>%
left_join(zillow_shp@data[, c("RegionID", "Name")]) %>%
mutate(highlight = pwhite_2000_2017 > 0 & pblack_2000_2017 < 0)
p2 <- ggplot() +
geom_polygon(data = temp_data[which(temp_data$highlight > 0),],
aes(x = long, y = lat, group = group), fill = "#00B28F", alpha = .8) +
geom_path(data = temp_data[which(temp_data$highlight > 0),],
aes(x = long, y = lat, group = group), col = "grey", alpha = .4) +
geom_polygon(data = temp_data[which(temp_data$highlight == 0),],
aes(x = long, y = lat, group = group), fill = "#FF5416", alpha = .2) +
geom_path(data = temp_data[which(temp_data$highlight == 0),],
aes(x = long, y = lat, group = group), col = "grey", alpha = .4) +
coord_equal() +
theme_minimal() +
theme(axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
theme(legend.position="none")
rm(temp_data)
grid.newpage()
page.layout <- grid.layout(nrow = 1, ncol = 2, widths=c(.7, .3))
pushViewport(viewport(layout = page.layout))
print(p1, vp=viewport(layout.pos.row = 1, layout.pos.col = 1))
print(p2, vp=viewport(layout.pos.row = 1, layout.pos.col = 2))
