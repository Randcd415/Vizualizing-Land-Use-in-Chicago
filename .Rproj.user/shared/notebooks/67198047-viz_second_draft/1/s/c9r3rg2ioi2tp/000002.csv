"0","######### Zoning ############3"
"0","zoning <- read_csv(here(""clean_data"", ""zoning.csv""), col_names = T)"
"2","Parsed with column specification:
cols(
  OBJECTID = col_integer(),
  REGION = col_integer(),
  Date = col_date(format = """"),
  Zoning = col_character(),
  FAR = col_double(),
  LANDMARKED = col_integer(),
  CREATE_DAT = col_date(format = """"),
  EDIT_DATE = col_date(format = """"),
  LAG_FAR = col_double(),
  UPZONE = col_integer(),
  DOWNZONE = col_integer()
)
"
"0","zoning$YEAR <- year(zoning$Date)"
"0","zoning_group <- group_by(zoning, REGION, YEAR) %>% summarize(UPZONE = sum(UPZONE, na.rm = T),"
"0","                                                   DOWNZONE = sum(DOWNZONE, na.rm = T),"
"0","                                                   LANDMARKED = sum(LANDMARKED, na.rm = T),"
"0","                                                   FAR = mean(FAR, na.rm = T))"
"0","zoning_group <- zoning_group[order(zoning_group$REGION, zoning_group$YEAR),]"
"0","zoning_plot <- zoning_group %>% group_by(REGION) %>% mutate(UPZONE_cs = cumsum(UPZONE),"
"0","                                   DOWNZONE_cs = cumsum(DOWNZONE),"
"0","                                   LANDMARKED_cs = cumsum(LANDMARKED))"
"0","############# PERMITS ####################"
"0","permits <- read_csv(here(""clean_data"", ""permits.csv""), col_names = T)"
"2","Parsed with column specification:
cols(
  ID = col_integer(),
  `PERMIT#` = col_integer(),
  PERMIT_TYPE = col_character(),
  ISSUE_DATE = col_date(format = """"),
  ESTIMATED_COST = col_double(),
  AMOUNT_WAIVED = col_double(),
  AMOUNT_PAID = col_double(),
  TOTAL_FEE = col_double(),
  STREET_NUMBER = col_integer(),
  `STREET DIRECTION` = col_character(),
  STREET_NAME = col_character(),
  SUFFIX = col_character(),
  WORK_DESCRIPTION = col_character(),
  LOCATION = col_character(),
  RegionID = col_integer()
)
"
"0","permits$YEAR <- year(permits$ISSUE_DATE)"
"0","names(permits)[15] <- ""REGION"""
"0","permits_plot <- permits[order(permits$REGION, permits$YEAR),] %>%"
"0","                    group_by(REGION, YEAR) %>% "
"0","                    summarize(num_permits = length(ID)) %>%"
"0","                    group_by(REGION) %>% mutate(permits_cs = cumsum(num_permits))"
"0","permits_collapsed <- permits_plot %>% group_by(REGION) %>% summarize(permits_cs = max(permits_cs))"
"0","############# HOME PRICE DATA ########################"
"0","zhvi <- read_csv(here(""clean_data"", ""zhvi.csv""), col_names = T)"
"2","Parsed with column specification:
cols(
  RegionID = col_integer(),
  RegionName = col_character(),
  SizeRank = col_integer(),
  Date = col_date(format = """"),
  HVI = col_integer()
)
"
"0","missing_vals <- zhvi %>% filter(!is.na(HVI)) %>% group_by(RegionName) %>% summarize(length = length(Date)) %>% subset(length < 272, select = RegionName)"
"0","zhvi_clean <- zhvi %>% filter(!(RegionName %in% missing_vals$RegionName)) %>% group_by(Date) %>%"
"0","  mutate(ranking = order(order(HVI, decreasing = T)),"
"0","         YEAR = year(Date)) %>% ungroup() %>%"
"0","         group_by(RegionID, RegionName, YEAR) %>%"
"0","         summarize(mean_hvi = mean(HVI, na.rm = T),"
"0","                   mean_rank = mean(ranking, na.rm = T))"
"0","zhvi_trim <- zhvi_clean %>% filter(YEAR == max(zhvi_clean$YEAR) | YEAR == 2010 | YEAR == min(zhvi_clean$YEAR)) %>%"
"0","        unite(temp, c(""mean_hvi"", ""mean_rank"")) %>%"
"0","        spread(key = ""YEAR"", value = temp) %>% "
"0","        separate(""1996"", into = paste0(""1996_"", c(""mean_hvi"", ""mean_rank"")), sep = ""_"", convert = T) %>%"
"0","        separate(""2010"", into = paste0(""2010_"", c(""mean_hvi"", ""mean_rank"")), sep = ""_"", convert = T) %>%"
"0","        separate(""2018"", into = paste0(""2018_"", c(""mean_hvi"", ""mean_rank"")), sep = ""_"", convert = T) %>%"
"0","        mutate(change_rank = `2018_mean_rank` - `1996_mean_rank`,"
"0","               change_hvi = `2018_mean_hvi` - `1996_mean_hvi`)"
"0","############# ACS DATA FROM BROWN LOGITUDINAL DATABASE ########################"
"0","brown_acs <- read_csv(here(""clean_data"", ""brown_acs.csv""), col_names = T)"
"2","Parsed with column specification:
cols(
  .default = col_double(),
  YEAR = col_integer(),
  REGION = col_integer()
)
"
"2","See spec(...) for full column specifications.
"
"0","brown_acs$YEAR %<>% as.numeric()"
"0","############ AGGREGATE CENSUS DATA TO TRACT LEVEL ############"
"0","brown_spread <- brown_acs %>% "
"0","  select(names(brown_acs)[c(1:2, 6, 11, 15:24)]) %>%"
"0","  unite(temp, names(brown_acs)[c(2, 6, 15:24)]) %>%"
"0","  spread(key = ""YEAR"", value = ""temp"") %>%"
"0","  separate(""1970"", into = paste0(""1970_"", names(brown_acs)[c(2, 6, 15:24)]), sep = ""_"", convert = T) %>%"
"0","  separate(""1980"", into = paste0(""1980_"", names(brown_acs)[c(2, 6, 15:24)]), sep = ""_"", convert = T) %>%"
"0","  separate(""1990"", into = paste0(""1990_"", names(brown_acs)[c(2, 6, 15:24)]), sep = ""_"", convert = T) %>%"
"0","  separate(""2000"", into = paste0(""2000_"", names(brown_acs)[c(2, 6, 15:24)]), sep = ""_"", convert = T) %>%"
"0","  separate(""2010"", into = paste0(""2010_"", names(brown_acs)[c(2, 6, 15:24)]), sep = ""_"", convert = T) %>%"
"0","  mutate(`1980_hu_pchange` = (`1980_hu` - `1970_hu`) / `1970_hu`,"
"0","         `1990_hu_pchange` = (`1990_hu` - `1980_hu`) / `1980_hu`,"
"0","         `2000_hu_pchange` = (`2000_hu` - `1990_hu`) / `1990_hu`,"
"0","         `2010_hu_pchange` = (`2010_hu` - `2000_hu`) / `2000_hu`) "
"0","brown_neighborhood <- brown_acs %>% "
"0","  group_by(REGION, YEAR) %>%"
"0","  summarize(pop = sum(pop, na.rm = T),"
"0","            nhwht = sum(nhwht, na.rm = T),"
"0","            nhblk = sum(nhblk, na.rm = T),"
"0","            asian = sum(asian, na.rm = T),"
"0","            hu = sum(hu, na.rm = T),"
"0","            vac = sum(vac, na.rm = T),"
"0","            ohu = sum(ohu, na.rm = T),"
"0","            rent = sum(rent, na.rm = T),"
"0","            hisp = sum(hisp, na.rm = T),"
"0","            land_area = sum(land_area, na.rm = T)) %>%"
"0","  mutate(pwhite = nhwht/pop,"
"0","       pblack = nhblk/pop,"
"0","       pasian = asian/pop,"
"0","       phisp = hisp/pop,"
"0","       pohu = ohu/hu,"
"0","       pown = rent/hu,"
"0","       pop_d_h = pop/hu,"
"0","       pop_d_l = pop/land_area,"
"0","       h_d_pop = hu/pop,"
"0","       h_d_land = hu/land_area)"
"0","brown_neighborhood_plot <- brown_neighborhood %>% select(names(brown_neighborhood)[c(1:3, 7, 13:22)]) %>%"
"0","  unite(temp, names(brown_neighborhood)[c(3, 7, 13:22)]) %>%"
"0","  spread(key = ""YEAR"", value = ""temp"") %>%"
"0","  separate(""1970"", into = paste0(""1970_"", names(brown_neighborhood)[c(3, 7, 13:22)]), sep = ""_"", convert = T) %>%"
"0","  separate(""1980"", into = paste0(""1980_"", names(brown_neighborhood)[c(3, 7, 13:22)]), sep = ""_"", convert = T) %>%"
"0","  separate(""1990"", into = paste0(""1990_"", names(brown_neighborhood)[c(3, 7, 13:22)]), sep = ""_"", convert = T) %>%"
"0","  separate(""2000"", into = paste0(""2000_"", names(brown_neighborhood)[c(3, 7, 13:22)]), sep = ""_"", convert = T) %>%"
"0","  separate(""2010"", into = paste0(""2010_"", names(brown_neighborhood)[c(3, 7, 13:22)]), sep = ""_"", convert = T) %>%"
"0","  mutate(`1980_hu_change` = (`1980_hu` - `1970_hu`),"
"0","         `1990_hu_change` = (`1990_hu` - `1980_hu`),"
"0","         `2000_hu_change` = (`2000_hu` - `1990_hu`),"
"0","         `2010_hu_change` = (`2010_hu` - `2000_hu`),"
"0","         `1990_2010_hu_change` = (`2010_hu` - `1990_hu`)) %>%"
"0","########### MERGE EVERYTHING TOGETHER ############3"
"0","left_join(zoning_plot[which(zoning_plot$YEAR == 2019),], by = ""REGION"") %>%"
"0","left_join(permits_collapsed)"
"2","Joining, by = ""REGION""
"
"0","neighborhood_price_dem <- inner_join(zhvi_trim, brown_neighborhood_plot, by = c(""RegionID"" = ""REGION"")) %>%"
"0","                          mutate(hu_pchange_from_1990 = (`2010_hu` - `1990_hu`) / `1990_hu`,"
"0","                                 pwhite_from_1990 = (`2010_pwhite` - `1990_pwhite`) / `1990_pwhite`,"
"0","                                 ppop_from_1990 = (`2010_pop` - `1990_pop`) / `1990_pop`,"
"0","                                 pop_bins = cut(`2010_pop`, breaks = seq(0, 100000, 25000), include.lowest = TRUE))"
"0","############ MERGE TRACT SHAPEFILE TO CENSUS DATA ################"
"0","tract_2010 <- readOGR(here(""raw_data"", ""Boundaries - Census Tracts - 2010""), layer = ""geo_export_52dfa5f1-1eaf-49e1-9862-1998098d508c"") %>%"
"0","  sp::merge(brown_spread, by.x = ""geoid10"", by.y = ""trtid10"")"
"1","OGR data source with driver:"
"1"," "
"1","ESRI Shapefile"
"1"," "
"1","
"
"1","Source: """
"1","C:\Users\7450\Documents\Harris MPP\Q5\Data Viz\project_chicago_zoning\raw_data\Boundaries - Census Tracts - 2010"
"1",""", layer: """
"1","geo_export_52dfa5f1-1eaf-49e1-9862-1998098d508c"
"1",""""
"1","
"
"1","with"
"1"," "
"1","801"
"1"," "
"1","features"
"1","
"
"1","It has"
"1"," "
"1","9"
"1"," "
"1","fields"
"1","
"
"0","############ MERGE NEIGHBORHOOD SHAPEFILE WITH CENSUS DATA"
"0","zillow_shp <- readOGR(here(""raw_data"", ""ZillowNeighborhoods-IL""), layer = ""ZillowNeighborhoods-IL"")"
"1","OGR data source with driver:"
"1"," "
"1","ESRI Shapefile"
"1"," "
"1","
"
"1","Source: """
"1","C:\Users\7450\Documents\Harris MPP\Q5\Data Viz\project_chicago_zoning\raw_data\ZillowNeighborhoods-IL"
"1",""", layer: """
"1","ZillowNeighborhoods-IL"
"1",""""
"1","
"
"1","with"
"1"," "
"1","318"
"1"," "
"1","features"
"1","
"
"1","It has"
"1"," "
"1","5"
"1"," "
"1","fields"
"1","
"
"0","zillow_shp <- zillow_shp[which(zillow_shp$City == ""Chicago""),]"
"0","zillow_acs <- sp::merge(zillow_shp, brown_neighborhood_plot, by.x = ""RegionID"", by.y = ""REGION"")"
